package mailConfig;

import java.awt.Desktop;
import java.io.File;

import javax.swing.JOptionPane;
import javax.swing.SwingWorker;

import profilePage.DataProfileManager;
import properties.PropertiesManager;

public class Worker extends SwingWorker<Boolean, Void> {

	private GifThread gifThread;
	public Worker(GifThread gifThread){
		this.gifThread=gifThread;
	}
	@Override
	protected Boolean doInBackground() throws Exception {

		String[] dataMail = DataProfileManager.getData();
		if (SendMail.sendMail(dataMail[dataMail.length - 1],
				PdfCreator.getPath(),
				String.valueOf(PdfCreator.getDocumentNumber()))) {
			if (SendMail.sendMail(SendMail.OUR_MAIL, PdfCreator.getPath(),
					String.valueOf(PdfCreator.getDocumentNumber()))) {
				JOptionPane.showMessageDialog(null, PropertiesManager
						.getProperties(PropertiesManager.SM_SEND_OK));
				try {
					Desktop.getDesktop().open(new File(PdfCreator.getPath()));
				} catch (Exception e) {
					e.printStackTrace();
				}
				gifThread.changeVisibility(false);
				return true;
			} else {
				JOptionPane.showMessageDialog(null, PropertiesManager
						.getProperties(PropertiesManager.SM_SEND_ERROR));
				gifThread.changeVisibility(false);
				return false;
			}
		} else {
			JOptionPane.showMessageDialog(null, PropertiesManager
					.getProperties(PropertiesManager.SM_SEND_ERROR));
			gifThread.changeVisibility(false);
			return false;
		}

	}

}
